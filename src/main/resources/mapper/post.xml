<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.trip.domain.post.mapper.PostMapper">

    <resultMap id="post" type="post">
        <result column="writer_id" property="writerId"></result>
        <result column="is_deleted" property="isDeleted"></result>
    </resultMap>

    <insert id="insert" parameterType="post">
        insert into post (writer_id, title, category, content, is_deleted, hit)
        values (${writerId}, #{title}, #{category}, #{content}, 0, 0)
    </insert>

    <select id="findById" parameterType="long" resultMap="post">
        select id, writer_id, title, category, content, hit
        from post
        where id = ${postId} and is_deleted = 0
    </select>

    <select id="findAll" parameterType="map" resultMap="post">
        select id, writer_id, title, category, content, hit
        from post
        <trim prefix="where" prefixOverrides="and">
            <if test="category != null and category != ''">
                and category = #{category}
            </if>
            <if test="writer_id != null and writer_id != ''">
                and writer_id = #{writerId}
            </if>
            and is_deleted = 0
        </trim>
    </select>

    <update id="update" parameterType="post">
        update post
        <trim prefix="set" prefixOverrides=",">
            <if test="title != null and title != ''">
                , title = #{title}
            </if>
            <if test="content != null and content != ''">
                , content = #{content}
            </if>
        </trim>
        where id = ${id}
    </update>

    <update id="updateHit" parameterType="long">
        update post set hit = hit + 1
        where id = ${postId}
    </update>

    <update id="deleteById" parameterType="long">
        update post set is_deleted = 1
        where id = ${postId}
    </update>

</mapper>